"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[50],{7295:function(t,e,a){a.d(e,{CP:function(){return getCategories},Cn:function(){return getProductInfo},Rb:function(){return validateCredentials},aj:function(){return checkAndDisableCampaignsIfBudgetExceeded},h_:function(){return getProductStock},jw:function(){return getProductList},k9:function(){return getCampaignProducts},kC:function(){return updateCampaignBudget},o$:function(){return getProductPrices},or:function(){return validatePerformanceCredentials},ov:function(){return updateBids},x:function(){return getCampaignsList}});var r=a(4829);let validateCredentials=async t=>{try{return await r.Z.post("https://api-seller.ozon.ru/v1/marketing/campaign/list",{},{headers:{"Client-Id":t.clientId,"Api-Key":t.apiKey,"Content-Type":"application/json"}}),{valid:!0,error:null}}catch(t){var e,a,n;return{valid:!1,error:(null===(e=t.response)||void 0===e?void 0:e.status)===403?"Неверные учетные данные API":(null===(n=t.response)||void 0===n?void 0:null===(a=n.data)||void 0===a?void 0:a.message)||"Ошибка проверки учетных данных"}}},validatePerformanceCredentials=async t=>{try{return await r.Z.post("https://performance.ozon.ru/api/client/statistics",{dateFrom:new Date(Date.now()-6048e5).toISOString().split("T")[0],dateTo:new Date().toISOString().split("T")[0],groupBy:["DATE"]},{headers:{"Client-Id":t.clientId,"Api-Key":t.apiKey,"Content-Type":"application/json"}}),{valid:!0,error:null}}catch(t){var e,a,n;return{valid:!1,error:(null===(e=t.response)||void 0===e?void 0:e.status)===403?"Неверные учетные данные Performance API":(null===(n=t.response)||void 0===n?void 0:null===(a=n.data)||void 0===a?void 0:a.message)||"Ошибка проверки учетных данных Performance API"}}},getCampaignsList=async t=>{try{let e=await r.Z.post("https://api-seller.ozon.ru/v1/marketing/campaign/list",{},{headers:{"Client-Id":t.clientId,"Api-Key":t.apiKey,"Content-Type":"application/json"}});return{data:e.data,error:null}}catch(t){var e,a;return{data:null,error:(null===(a=t.response)||void 0===a?void 0:null===(e=a.data)||void 0===e?void 0:e.message)||"Ошибка получения списка кампаний"}}},updateBids=async(t,e)=>{try{let a=await r.Z.post("https://api-seller.ozon.ru/v1/marketing/bid/set",{bids:e.map(t=>({campaign_id:t.campaignId,product_id:t.productId,bid:t.newBid}))},{headers:{"Client-Id":t.clientId,"Api-Key":t.apiKey,"Content-Type":"application/json"}});return{data:a.data,error:null}}catch(t){var a,n;return{data:null,error:(null===(n=t.response)||void 0===n?void 0:null===(a=n.data)||void 0===a?void 0:a.message)||"Ошибка обновления ставок"}}},updateCampaignBudget=async(t,e,a)=>{try{let n=await r.Z.post("https://api-seller.ozon.ru/v1/marketing/campaign/budget/update",{campaign_id:e,budget:a},{headers:{"Client-Id":t.clientId,"Api-Key":t.apiKey,"Content-Type":"application/json"}});return{data:n.data,error:null}}catch(t){var n,i;return{data:null,error:(null===(i=t.response)||void 0===i?void 0:null===(n=i.data)||void 0===n?void 0:n.message)||"Ошибка обновления бюджета кампании"}}},getPerformanceStatistics=async(t,e,a)=>{try{let n=await r.Z.post("https://performance.ozon.ru/api/client/statistics",{dateFrom:e,dateTo:a,groupBy:["DATE","CAMPAIGN_ID","CAMPAIGN_NAME"]},{headers:{"Client-Id":t.clientId,"Api-Key":t.apiKey,"Content-Type":"application/json"}});return{data:n.data,error:null}}catch(t){var n,i;return{data:null,error:(null===(i=t.response)||void 0===i?void 0:null===(n=i.data)||void 0===n?void 0:n.message)||"Ошибка получения статистики Performance API"}}},updateCampaignStatus=async(t,e,a)=>{try{let n=await r.Z.post("https://api-seller.ozon.ru/v1/marketing/campaign/status/update",{campaign_id:e,status:a},{headers:{"Client-Id":t.clientId,"Api-Key":t.apiKey,"Content-Type":"application/json"}});return{data:n.data,error:null}}catch(t){var n,i;return{data:null,error:(null===(i=t.response)||void 0===i?void 0:null===(n=i.data)||void 0===n?void 0:n.message)||"Ошибка обновления статуса кампании"}}},updateCampaignsStatuses=async(t,e)=>{try{let a=e.map(e=>updateCampaignStatus(t,e.campaignId,e.status)),r=await Promise.allSettled(a),n=r.filter(t=>"fulfilled"===t.status).length,i=r.filter(t=>"rejected"===t.status).length;return{data:{success:n,failed:i,total:e.length},error:null}}catch(t){var a,r;return{data:null,error:(null===(r=t.response)||void 0===r?void 0:null===(a=r.data)||void 0===a?void 0:a.message)||"Ошибка массового обновления статусов кампаний"}}},getCampaignProducts=async(t,e)=>{try{let a=await r.Z.post("https://api-seller.ozon.ru/v1/marketing/campaign/products",{campaign_id:e},{headers:{"Client-Id":t.clientId,"Api-Key":t.apiKey,"Content-Type":"application/json"}});return{data:a.data,error:null}}catch(t){var a,n;return{data:null,error:(null===(n=t.response)||void 0===n?void 0:null===(a=n.data)||void 0===a?void 0:a.message)||"Ошибка получения товаров кампании"}}},getProductList=async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;try{let i=await r.Z.post("https://api-seller.ozon.ru/v2/product/list",{filter:e,limit:a,offset:n},{headers:{"Client-Id":t.clientId,"Api-Key":t.apiKey,"Content-Type":"application/json"}});return{data:i.data,error:null}}catch(t){var i,o;return{data:null,error:(null===(o=t.response)||void 0===o?void 0:null===(i=o.data)||void 0===i?void 0:i.message)||"Ошибка получения списка товаров"}}},getProductInfo=async(t,e)=>{try{let a=await r.Z.post("https://api-seller.ozon.ru/v2/product/info/list",{product_id:e},{headers:{"Client-Id":t.clientId,"Api-Key":t.apiKey,"Content-Type":"application/json"}});return{data:a.data,error:null}}catch(t){var a,n;return{data:null,error:(null===(n=t.response)||void 0===n?void 0:null===(a=n.data)||void 0===a?void 0:a.message)||"Ошибка получения информации о товарах"}}},getProductStock=async(t,e)=>{try{let a=await r.Z.post("https://api-seller.ozon.ru/v3/product/info/stocks",{product_id:e},{headers:{"Client-Id":t.clientId,"Api-Key":t.apiKey,"Content-Type":"application/json"}});return{data:a.data,error:null}}catch(t){var a,n;return{data:null,error:(null===(n=t.response)||void 0===n?void 0:null===(a=n.data)||void 0===a?void 0:a.message)||"Ошибка получения информации об остатках"}}},getProductPrices=async(t,e)=>{try{let a=await r.Z.post("https://api-seller.ozon.ru/v4/product/info/prices",{product_id:e},{headers:{"Client-Id":t.clientId,"Api-Key":t.apiKey,"Content-Type":"application/json"}});return{data:a.data,error:null}}catch(t){var a,n;return{data:null,error:(null===(n=t.response)||void 0===n?void 0:null===(a=n.data)||void 0===a?void 0:a.message)||"Ошибка получения информации о ценах"}}},getCategories=async t=>{try{let e=await r.Z.post("https://api-seller.ozon.ru/v2/category/tree",{},{headers:{"Client-Id":t.clientId,"Api-Key":t.apiKey,"Content-Type":"application/json"}});return{data:e.data,error:null}}catch(t){var e,a;return{data:null,error:(null===(a=t.response)||void 0===a?void 0:null===(e=a.data)||void 0===e?void 0:e.message)||"Ошибка получения категорий товаров"}}},checkAndDisableCampaignsIfBudgetExceeded=async function(t,e,a){let r=!(arguments.length>3)||void 0===arguments[3]||arguments[3];try{let i=new Date().toISOString().split("T")[0],{data:o,error:d}=await getPerformanceStatistics(e,i,i);if(d)throw Error(d);let l=0,s={};o&&o.rows&&o.rows.forEach(t=>{var e,a,r;let n=null===(e=t.dimensions.find(t=>"CAMPAIGN_ID"===t.id))||void 0===e?void 0:e.value,i=null===(a=t.dimensions.find(t=>"CAMPAIGN_NAME"===t.id))||void 0===a?void 0:a.value,o=(null===(r=t.metrics.find(t=>"SPENDING"===t.id))||void 0===r?void 0:r.value)||0;n&&(s[n]={id:n,name:i,spent:parseFloat(o)},l+=parseFloat(o))});let u=l>=a;if(u&&r){var n;let{data:e,error:r}=await getCampaignsList(t);if(r)throw Error(r);let i=(null==e?void 0:null===(n=e.campaigns)||void 0===n?void 0:n.filter(t=>"active"===t.state))||[];if(i.length>0){let e=i.map(t=>({campaignId:t.id,status:"paused"})),{data:r,error:n}=await updateCampaignsStatuses(t,e);if(n)throw Error(n);return{data:{budgetExceeded:!0,totalSpent:l,dailyBudget:a,campaignsDisabled:r.success,campaignSpending:s},error:null}}}return{data:{budgetExceeded:u,totalSpent:l,dailyBudget:a,campaignsDisabled:0,campaignSpending:s},error:null}}catch(t){return{data:null,error:t.message||"Ошибка проверки и отключения кампаний"}}}},7823:function(t,e,a){a.d(e,{OQ:function(){return n},m1:function(){return getBudgetSettings},rO:function(){return updateBudgetSettings}});var r=a(4756);let n=(0,r.eI)("https://llkacrchwiefgdgmuixl.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imxsa2FjcmNod2llZmdkZ211aXhsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc0NjYyNzQsImV4cCI6MjA2MzA0MjI3NH0.b9RLZFDfQH_svlQDF0V2g90P3vwPorlnwGZLl3S69-U"),getBudgetSettings=async t=>{let{data:e,error:a}=await n.from("budget_settings").select("*").eq("user_id",t).single();return a&&"PGRST116"!==a.code?{data:null,error:a}:{data:e||{user_id:t,daily_limit:0,notification_threshold:80,is_active:!0},error:null}},updateBudgetSettings=async(t,e)=>{let a={user_id:t,...e,updated_at:new Date().toISOString()},{data:r,error:i}=await n.from("budget_settings").upsert(a).select().single();return{data:r,error:i}}}}]);