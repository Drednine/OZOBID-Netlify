(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[850],{2258:function(e,i,s){Promise.resolve().then(s.bind(s,4762))},4762:function(e,i,s){"use strict";s.r(i),s.d(i,{default:function(){return MassBidsPage}});var t=s(7437),n=s(2265),a=s(7823),r=s(1865),l=s(7295),components_MassBidManagementForm=e=>{let{userId:i,credentials:s}=e,[a,d]=(0,n.useState)([]),[c,h]=(0,n.useState)([]),[o,u]=(0,n.useState)(!1),[x,m]=(0,n.useState)(""),[j,p]=(0,n.useState)(new Set),{register:f,handleSubmit:g,watch:b,setValue:v}=(0,r.cI)({defaultValues:{campaignId:"",bidAction:"set",bidValue:100,minBid:50,maxBid:500}});(0,n.useEffect)(()=>{loadCampaigns()},[]);let loadCampaigns=async()=>{u(!0);try{let{data:e}=await (0,l.x)(s);e&&e.campaigns&&d(e.campaigns)}catch(e){console.error(e)}finally{u(!1)}},handleCampaignSelect=async e=>{u(!0);try{let{data:i}=await (0,l.k9)(s,e);i&&i.products&&h(i.products)}catch(e){console.error(e)}finally{u(!1)}},onSubmit=async e=>{if(0!==j.size){u(!0);try{let i=Array.from(j).map(i=>({campaignId:e.campaignId,productId:i,newBid:e.bidValue}));await (0,l.ov)(s,i),m("Ставки успешно обновлены")}catch(e){console.error(e),m("Ошибка при обновлении ставок")}finally{u(!1)}}};return(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{children:"Массовое управление ставками"}),x&&(0,t.jsx)("div",{children:x}),(0,t.jsx)("div",{children:(0,t.jsxs)("form",{onSubmit:g(onSubmit),children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{children:"Выберите кампанию"}),(0,t.jsxs)("select",{...f("campaignId",{onChange:e=>handleCampaignSelect(e.target.value)}),children:[(0,t.jsx)("option",{value:"",children:"Выберите кампанию"}),a.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{children:"Новая ставка (руб.)"}),(0,t.jsx)("input",{type:"number",...f("bidValue")})]}),(0,t.jsx)("button",{type:"submit",disabled:o||0===j.size,children:o?"Обновление...":"Обновить ставки"})]})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{children:"Товары в кампании"}),(0,t.jsxs)("div",{children:["Выбрано: ",j.size," из ",c.length]}),c.length>0?(0,t.jsxs)("table",{children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"Выбрать"}),(0,t.jsx)("th",{children:"Название"}),(0,t.jsx)("th",{children:"Текущая ставка"})]})}),(0,t.jsx)("tbody",{children:c.map(e=>(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{children:(0,t.jsx)("input",{type:"checkbox",onChange:()=>{let i=new Set(j);i.has(e.id)?i.delete(e.id):i.add(e.id),p(i)}})}),(0,t.jsx)("td",{children:e.name}),(0,t.jsxs)("td",{children:[e.bid," руб."]})]},e.id))})]}):(0,t.jsx)("div",{children:o?"Загрузка...":"Нет товаров для отображения"})]})]})};function MassBidsPage(){let[e,i]=(0,n.useState)(null),[s,r]=(0,n.useState)(null),[l,d]=(0,n.useState)(!0),[c,h]=(0,n.useState)("");(0,n.useEffect)(()=>{checkAuth()},[]);let checkAuth=async()=>{try{d(!0);let{data:e,error:s}=await a.OQ.auth.getUser();if(s)throw Error(s.message);if(!(null==e?void 0:e.user))throw Error("Необходимо авторизоваться");i(e.user);let{data:t,error:n}=await a.OQ.from("ozon_credentials").select("*").eq("user_id",e.user.id).eq("is_active",!0).single();if(n||!t)throw Error("Необходимо добавить учетные данные OZON");r({clientId:t.client_id,apiKey:t.api_key})}catch(e){h(e.message)}finally{d(!1)}};return l?(0,t.jsx)("div",{children:"Загрузка..."}):c?(0,t.jsx)("div",{className:"text-red-500",children:c}):(0,t.jsxs)("div",{className:"container mx-auto p-4",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Массовое управление ставками"}),(0,t.jsx)(components_MassBidManagementForm,{userId:e.id,credentials:s})]})}}},function(e){e.O(0,[921,865,50,971,472,744],function(){return e(e.s=2258)}),_N_E=e.O()}]);