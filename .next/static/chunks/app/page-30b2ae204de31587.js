(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{9877:function(e,t,s){Promise.resolve().then(s.bind(s,8976))},8976:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return Home}});var r=s(7437),l=s(2265),a=s(1865),i=s(7823),components_RegisterForm=e=>{let{onSuccess:t}=e,[s,d]=(0,l.useState)(!1),[c,m]=(0,l.useState)(null),{register:n,handleSubmit:o,watch:x,formState:{errors:u}}=(0,a.cI)({defaultValues:{email:"",password:"",confirmPassword:"",fullName:"",companyName:""}}),p=x("password"),onSubmit=async e=>{d(!0),m(null);try{let{data:s,error:r}=await i.OQ.auth.signUp({email:e.email,password:e.password,options:{data:{full_name:e.fullName,company_name:e.companyName}}});if(r)throw Error(r.message);if(s&&s.user){let{error:r}=await i.OQ.from("users").insert([{id:s.user.id,email:e.email,full_name:e.fullName,company_name:e.companyName,created_at:new Date().toISOString()}]);if(r)throw Error(r.message);m({text:"Регистрация успешна! Проверьте вашу почту для подтверждения аккаунта.",type:"success"}),t&&t()}}catch(e){m({text:"Ошибка при регистрации: ".concat(e.message),type:"error"})}finally{d(!1)}};return(0,r.jsxs)("div",{className:"w-full max-w-md mx-auto",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold mb-6 text-center",children:"Регистрация"}),c&&(0,r.jsx)("div",{className:"p-4 mb-4 rounded ".concat("error"===c.type?"bg-red-100 text-red-700":"success"===c.type?"bg-green-100 text-green-700":"bg-blue-100 text-blue-700"),children:c.text}),(0,r.jsxs)("form",{onSubmit:o(onSubmit),className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),(0,r.jsx)("input",{id:"email",type:"email",className:"w-full px-3 py-2 border border-gray-300 rounded-md",...n("email",{required:"Email обязателен",pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Некорректный email"}})}),u.email&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-600",children:u.email.message})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Пароль"}),(0,r.jsx)("input",{id:"password",type:"password",className:"w-full px-3 py-2 border border-gray-300 rounded-md",...n("password",{required:"Пароль обязателен",minLength:{value:6,message:"Пароль должен содержать минимум 6 символов"}})}),u.password&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-600",children:u.password.message})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:"Подтверждение пароля"}),(0,r.jsx)("input",{id:"confirmPassword",type:"password",className:"w-full px-3 py-2 border border-gray-300 rounded-md",...n("confirmPassword",{required:"Подтвердите пароль",validate:e=>e===p||"Пароли не совпадают"})}),u.confirmPassword&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-600",children:u.confirmPassword.message})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"fullName",className:"block text-sm font-medium text-gray-700 mb-1",children:"Полное имя"}),(0,r.jsx)("input",{id:"fullName",type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-md",...n("fullName",{required:"Укажите ваше имя"})}),u.fullName&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-600",children:u.fullName.message})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"companyName",className:"block text-sm font-medium text-gray-700 mb-1",children:"Название компании"}),(0,r.jsx)("input",{id:"companyName",type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-md",...n("companyName",{required:"Укажите название компании"})}),u.companyName&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-600",children:u.companyName.message})]}),(0,r.jsx)("button",{type:"submit",className:"w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-md transition duration-200",disabled:s,children:s?"Регистрация...":"Зарегистрироваться"})]})]})},d=s(7295),components_MultiStoreForm=e=>{let{userId:t,onSuccess:s}=e,[c,m]=(0,l.useState)(!1),[n,o]=(0,l.useState)(!1),[x,u]=(0,l.useState)(""),[p,h]=(0,l.useState)(!1),{register:b,handleSubmit:y,formState:{errors:f}}=(0,a.cI)(),validateApiKeys=async e=>{o(!0),u("Проверка ключей API...");try{let t={clientId:e.sellerClientId,apiKey:e.sellerApiKey},{valid:s,error:r}=await (0,d.Rb)(t);if(!1===s)throw Error(r||"Ошибка валидации Seller API ключей");let l={clientId:e.performanceClientId,apiKey:e.performanceClientSecret},{valid:a,error:i}=await (0,d.or)(l);if(!1===a)throw Error(i||"Ошибка валидации Performance API ключей");return u("Ключи API успешно проверены"),!0}catch(e){return u("Ошибка валидации: "+e.message),!1}finally{o(!1)}},onSubmit=async e=>{m(!0),u(""),h(!1);try{let r=await validateApiKeys(e);if(!1===r)return;let{error:l}=await i.OQ.from("stores").insert([{user_id:t,name:e.storeName,client_id:e.sellerClientId,api_key:e.sellerApiKey,performance_client_id:e.performanceClientId,performance_client_secret:e.performanceClientSecret,created_at:new Date().toISOString()}]);if(l)throw Error(l.message);h(!0),u("Магазин успешно добавлен!"),s&&s(e.sellerClientId,e.sellerApiKey)}catch(e){u("Ошибка при добавлении магазина: "+e.message)}finally{m(!1)}};return(0,r.jsxs)("div",{className:"max-w-md mx-auto bg-white p-6 rounded-lg shadow-md",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold mb-6",children:"Добавление магазина Ozon"}),x&&(0,r.jsx)("div",{className:"p-4 mb-4 rounded "+(p?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:x}),(0,r.jsxs)("form",{onSubmit:y(onSubmit),children:[(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{htmlFor:"storeName",className:"block text-sm font-medium text-gray-700 mb-1",children:"Название магазина"}),(0,r.jsx)("input",{id:"storeName",type:"text",className:"w-full px-3 py-2 border rounded-md "+(f.storeName?"border-red-500":"border-gray-300"),...b("storeName",{required:"Название магазина обязательно"})}),f.storeName&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-500",children:f.storeName.message})]}),(0,r.jsxs)("div",{className:"border-t border-gray-200 pt-4 mb-4",children:[(0,r.jsx)("h3",{className:"text-lg font-medium mb-3",children:"Seller API (для работы с товарами)"}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{htmlFor:"sellerClientId",className:"block text-sm font-medium text-gray-700 mb-1",children:"Client ID"}),(0,r.jsx)("input",{id:"sellerClientId",type:"text",className:"w-full px-3 py-2 border rounded-md "+(f.sellerClientId?"border-red-500":"border-gray-300"),...b("sellerClientId",{required:"Client ID обязателен"})}),f.sellerClientId&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-500",children:f.sellerClientId.message})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{htmlFor:"sellerApiKey",className:"block text-sm font-medium text-gray-700 mb-1",children:"API Key"}),(0,r.jsx)("input",{id:"sellerApiKey",type:"password",className:"w-full px-3 py-2 border rounded-md "+(f.sellerApiKey?"border-red-500":"border-gray-300"),...b("sellerApiKey",{required:"API Key обязателен"})}),f.sellerApiKey&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-500",children:f.sellerApiKey.message})]})]}),(0,r.jsxs)("div",{className:"border-t border-gray-200 pt-4 mb-4",children:[(0,r.jsx)("h3",{className:"text-lg font-medium mb-3",children:"Performance API (для работы с рекламой)"}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{htmlFor:"performanceClientId",className:"block text-sm font-medium text-gray-700 mb-1",children:"Client ID"}),(0,r.jsx)("input",{id:"performanceClientId",type:"text",className:"w-full px-3 py-2 border rounded-md "+(f.performanceClientId?"border-red-500":"border-gray-300"),...b("performanceClientId",{required:"Performance Client ID обязателен"})}),f.performanceClientId&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-500",children:f.performanceClientId.message})]}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("label",{htmlFor:"performanceClientSecret",className:"block text-sm font-medium text-gray-700 mb-1",children:"Client Secret"}),(0,r.jsx)("input",{id:"performanceClientSecret",type:"password",className:"w-full px-3 py-2 border rounded-md "+(f.performanceClientSecret?"border-red-500":"border-gray-300"),...b("performanceClientSecret",{required:"Performance Client Secret обязателен"})}),f.performanceClientSecret&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-500",children:f.performanceClientSecret.message})]})]}),(0,r.jsx)("div",{className:"flex items-center justify-between",children:(0,r.jsx)("button",{type:"submit",className:"w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-md transition duration-200",disabled:c||n,children:c?"Добавление...":n?"Проверка ключей...":"Добавить магазин"})})]})]})},components_ProductExportForm=e=>{let{userId:t,credentials:s}=e,[i,c]=(0,l.useState)(!1),[m,n]=(0,l.useState)(!1),[o,x]=(0,l.useState)(""),[u,p]=(0,l.useState)([]),[h,b]=(0,l.useState)([]),[y,f]=(0,l.useState)([]),[g,N]=(0,l.useState)(0),[j,w]=(0,l.useState)(0),{register:v,handleSubmit:S,watch:k,formState:{errors:I}}=(0,a.cI)({defaultValues:{category:"all",searchQuery:"",exportType:"all",priceFilter:"all"}}),C=k("exportType"),P=k("priceFilter"),_=k("category"),F=k("searchQuery");return(0,l.useEffect)(()=>{let loadProducts=async()=>{c(!0),x("Загрузка списка товаров...");try{let{data:e,error:t}=await (0,d.jw)(s);if(t)throw Error(t.message||"Ошибка получения списка товаров");if(!e||!e.items||!Array.isArray(e.items))throw Error("Некорректный формат данных от API");w(e.items.length);let r=e.items.map(e=>e.product_id),l=[],a=new Set;for(let e=0;e<r.length;e+=100){N(Math.floor(e/r.length*100));let t=r.slice(e,e+100),{data:i}=await (0,d.Cn)(s,t),{data:c}=await (0,d.o$)(s,t),{data:m}=await (0,d.h_)(s,t);i&&i.items&&i.items.forEach(e=>{var t,s,r,i,d;let n=null==c?void 0:null===(t=c.items)||void 0===t?void 0:t.find(t=>t.product_id===e.product_id),o=null==m?void 0:null===(s=m.items)||void 0===s?void 0:s.find(t=>t.product_id===e.product_id);e.category&&a.add(e.category),l.push({id:e.product_id,name:e.name||"Без названия",sku:e.offer_id||"",category:e.category||"Без категории",price:(null==n?void 0:null===(r=n.price)||void 0===r?void 0:r.price)||0,oldPrice:(null==n?void 0:null===(i=n.price)||void 0===i?void 0:i.old_price)||0,stock:(null==o?void 0:null===(d=o.stocks)||void 0===d?void 0:d.reduce((e,t)=>e+(t.present||0),0))||0,status:e.status||"inactive",images:e.images||[],url:"https://ozon.ru/product/"+e.product_id})})}p(l),b(l);let i=Array.from(a).map(e=>({id:e,name:e}));f(i),x("Загружено "+l.length+" товаров")}catch(e){x("Ошибка загрузки товаров: "+e.message)}finally{c(!1),N(100)}};s.clientId&&s.apiKey&&loadProducts()},[s]),(0,l.useEffect)(()=>{if(0===u.length)return;let e=[...u];if("inStock"===C?e=e.filter(e=>e.stock>0):"outOfStock"===C&&(e=e.filter(e=>e.stock<=0)),"withPrice"===P?e=e.filter(e=>e.price>0):"withoutPrice"===P&&(e=e.filter(e=>e.price<=0)),_&&"all"!==_&&(e=e.filter(e=>e.category===_)),F){let t=F.toLowerCase();e=e.filter(e=>e.name.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t))}b(e)},[C,P,_,F,u]),(0,r.jsxs)("div",{className:"max-w-4xl mx-auto bg-white p-6 rounded-lg shadow-md",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold mb-6",children:"Выгрузка товаров"}),o&&(0,r.jsx)("div",{className:"p-4 mb-4 rounded bg-blue-100 text-blue-700",children:o}),i&&(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2.5 mb-2",children:(0,r.jsx)("div",{className:"bg-blue-600 h-2.5 rounded-full",style:{width:g+"%"}})}),(0,r.jsxs)("p",{className:"text-sm text-gray-500 text-center",children:["Загрузка товаров: ",g,"%"]})]}),(0,r.jsxs)("form",{onSubmit:S(()=>{n(!0);try{let e=h.map(e=>[e.id,'"'+e.name.replace(/"/g,'""')+'"',e.sku,'"'+e.category.replace(/"/g,'""')+'"',e.price,e.oldPrice,e.stock,e.status,e.url].join(",")),t=["ID,Название,Артикул,Категория,Цена,Старая цена,Остаток,Статус,URL",...e].join("\n"),s=new Blob([t],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(s),l=document.createElement("a");l.setAttribute("href",r),l.setAttribute("download","ozon-products-"+new Date().toISOString().split("T")[0]+".csv"),l.style.visibility="hidden",document.body.appendChild(l),l.click(),document.body.removeChild(l),x("Экспортировано "+h.length+" товаров")}catch(t){let e=t instanceof Error?t.message:"Неизвестная ошибка";x("Ошибка экспорта: "+e)}finally{n(!1)}}),className:"mb-6",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"category",className:"block text-sm font-medium text-gray-700 mb-1",children:"Категория"}),(0,r.jsxs)("select",{id:"category",className:"w-full px-3 py-2 border border-gray-300 rounded-md",...v("category"),children:[(0,r.jsx)("option",{value:"all",children:"Все категории"}),y.map(e=>(0,r.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"searchQuery",className:"block text-sm font-medium text-gray-700 mb-1",children:"Поиск по названию или артикулу"}),(0,r.jsx)("input",{id:"searchQuery",type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-md",placeholder:"Введите текст для поиска",...v("searchQuery")})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Фильтр по наличию"}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("input",{id:"all",type:"radio",value:"all",className:"h-4 w-4 text-blue-600",...v("exportType")}),(0,r.jsx)("label",{htmlFor:"all",className:"ml-2 text-sm text-gray-700",children:"Все товары"})]}),(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("input",{id:"inStock",type:"radio",value:"inStock",className:"h-4 w-4 text-blue-600",...v("exportType")}),(0,r.jsx)("label",{htmlFor:"inStock",className:"ml-2 text-sm text-gray-700",children:"Только в наличии"})]}),(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("input",{id:"outOfStock",type:"radio",value:"outOfStock",className:"h-4 w-4 text-blue-600",...v("exportType")}),(0,r.jsx)("label",{htmlFor:"outOfStock",className:"ml-2 text-sm text-gray-700",children:"Только отсутствующие"})]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Фильтр по цене"}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("input",{id:"allPrices",type:"radio",value:"all",className:"h-4 w-4 text-blue-600",...v("priceFilter")}),(0,r.jsx)("label",{htmlFor:"allPrices",className:"ml-2 text-sm text-gray-700",children:"Все товары"})]}),(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("input",{id:"withPrice",type:"radio",value:"withPrice",className:"h-4 w-4 text-blue-600",...v("priceFilter")}),(0,r.jsx)("label",{htmlFor:"withPrice",className:"ml-2 text-sm text-gray-700",children:"С ценой"})]}),(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("input",{id:"withoutPrice",type:"radio",value:"withoutPrice",className:"h-4 w-4 text-blue-600",...v("priceFilter")}),(0,r.jsx)("label",{htmlFor:"withoutPrice",className:"ml-2 text-sm text-gray-700",children:"Без цены"})]})]})]})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"text-sm text-gray-500",children:["Найдено товаров: ",h.length," из ",u.length]}),(0,r.jsx)("button",{type:"submit",className:"bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-md transition duration-200",disabled:i||m||0===h.length,children:m?"Экспорт...":"Экспортировать в CSV"})]})]}),(0,r.jsxs)("div",{className:"overflow-x-auto",children:[(0,r.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,r.jsx)("thead",{className:"bg-gray-50",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Название"}),(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Артикул"}),(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Цена"}),(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Остаток"})]})}),(0,r.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:h.slice(0,10).map(e=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:e.name}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.sku}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.price>0?e.price+" ₽":"-"}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.stock})]},e.id))})]}),h.length>10&&(0,r.jsxs)("div",{className:"py-3 text-center text-sm text-gray-500",children:["Показаны первые 10 из ",h.length," товаров"]})]})]})};let c="mock-user-id",m={clientId:"your-client-id",apiKey:"your-api-key"};function Home(){let[e,t]=(0,l.useState)("register");return(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 p-6",children:(0,r.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"Панель OZOBID"}),(0,r.jsxs)("div",{className:"flex gap-4 mb-6",children:[(0,r.jsx)("button",{onClick:()=>t("register"),className:"px-4 py-2 rounded ".concat("register"===e?"bg-blue-600 text-white":"bg-gray-200"),children:"Регистрация"}),(0,r.jsx)("button",{onClick:()=>t("stores"),className:"px-4 py-2 rounded ".concat("stores"===e?"bg-blue-600 text-white":"bg-gray-200"),children:"Магазины"}),(0,r.jsx)("button",{onClick:()=>t("export"),className:"px-4 py-2 rounded ".concat("export"===e?"bg-blue-600 text-white":"bg-gray-200"),children:"Выгрузка товаров"})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:["register"===e&&(0,r.jsx)(components_RegisterForm,{}),"stores"===e&&(0,r.jsx)(components_MultiStoreForm,{userId:c}),"export"===e&&(0,r.jsx)(components_ProductExportForm,{userId:c,credentials:m})]})]})})}}},function(e){e.O(0,[921,865,50,971,472,744],function(){return e(e.s=9877)}),_N_E=e.O()}]);