"use strict";exports.id=863,exports.ids=[863],exports.modules={9994:(t,e,a)=>{a.d(e,{CP:()=>getCategories,Cn:()=>getProductInfo,Rb:()=>validateCredentials,aj:()=>checkAndDisableCampaignsIfBudgetExceeded,h_:()=>getProductStock,jw:()=>getProductList,k9:()=>getCampaignProducts,kC:()=>updateCampaignBudget,o$:()=>getProductPrices,or:()=>validatePerformanceCredentials,ov:()=>updateBids,x:()=>getCampaignsList});var r=a(1145);let validateCredentials=async t=>{try{return await r.Z.post("https://api-seller.ozon.ru/v1/marketing/campaign/list",{},{headers:{"Client-Id":t.clientId,"Api-Key":t.apiKey,"Content-Type":"application/json"}}),{valid:!0,error:null}}catch(t){return{valid:!1,error:t.response?.status===403?"Неверные учетные данные API":t.response?.data?.message||"Ошибка проверки учетных данных"}}},validatePerformanceCredentials=async t=>{try{return await r.Z.post("https://performance.ozon.ru/api/client/statistics",{dateFrom:new Date(Date.now()-6048e5).toISOString().split("T")[0],dateTo:new Date().toISOString().split("T")[0],groupBy:["DATE"]},{headers:{"Client-Id":t.clientId,"Api-Key":t.apiKey,"Content-Type":"application/json"}}),{valid:!0,error:null}}catch(t){return{valid:!1,error:t.response?.status===403?"Неверные учетные данные Performance API":t.response?.data?.message||"Ошибка проверки учетных данных Performance API"}}},getCampaignsList=async t=>{try{let e=await r.Z.post("https://api-seller.ozon.ru/v1/marketing/campaign/list",{},{headers:{"Client-Id":t.clientId,"Api-Key":t.apiKey,"Content-Type":"application/json"}});return{data:e.data,error:null}}catch(t){return{data:null,error:t.response?.data?.message||"Ошибка получения списка кампаний"}}},updateBids=async(t,e)=>{try{let a=await r.Z.post("https://api-seller.ozon.ru/v1/marketing/bid/set",{bids:e.map(t=>({campaign_id:t.campaignId,product_id:t.productId,bid:t.newBid}))},{headers:{"Client-Id":t.clientId,"Api-Key":t.apiKey,"Content-Type":"application/json"}});return{data:a.data,error:null}}catch(t){return{data:null,error:t.response?.data?.message||"Ошибка обновления ставок"}}},updateCampaignBudget=async(t,e,a)=>{try{let n=await r.Z.post("https://api-seller.ozon.ru/v1/marketing/campaign/budget/update",{campaign_id:e,budget:a},{headers:{"Client-Id":t.clientId,"Api-Key":t.apiKey,"Content-Type":"application/json"}});return{data:n.data,error:null}}catch(t){return{data:null,error:t.response?.data?.message||"Ошибка обновления бюджета кампании"}}},getPerformanceStatistics=async(t,e,a)=>{try{let n=await r.Z.post("https://performance.ozon.ru/api/client/statistics",{dateFrom:e,dateTo:a,groupBy:["DATE","CAMPAIGN_ID","CAMPAIGN_NAME"]},{headers:{"Client-Id":t.clientId,"Api-Key":t.apiKey,"Content-Type":"application/json"}});return{data:n.data,error:null}}catch(t){return{data:null,error:t.response?.data?.message||"Ошибка получения статистики Performance API"}}},updateCampaignStatus=async(t,e,a)=>{try{let n=await r.Z.post("https://api-seller.ozon.ru/v1/marketing/campaign/status/update",{campaign_id:e,status:a},{headers:{"Client-Id":t.clientId,"Api-Key":t.apiKey,"Content-Type":"application/json"}});return{data:n.data,error:null}}catch(t){return{data:null,error:t.response?.data?.message||"Ошибка обновления статуса кампании"}}},updateCampaignsStatuses=async(t,e)=>{try{let a=e.map(e=>updateCampaignStatus(t,e.campaignId,e.status)),r=await Promise.allSettled(a),n=r.filter(t=>"fulfilled"===t.status).length,s=r.filter(t=>"rejected"===t.status).length;return{data:{success:n,failed:s,total:e.length},error:null}}catch(t){return{data:null,error:t.response?.data?.message||"Ошибка массового обновления статусов кампаний"}}},getCampaignProducts=async(t,e)=>{try{let a=await r.Z.post("https://api-seller.ozon.ru/v1/marketing/campaign/products",{campaign_id:e},{headers:{"Client-Id":t.clientId,"Api-Key":t.apiKey,"Content-Type":"application/json"}});return{data:a.data,error:null}}catch(t){return{data:null,error:t.response?.data?.message||"Ошибка получения товаров кампании"}}},getProductList=async(t,e={},a=100,n=0)=>{try{let s=await r.Z.post("https://api-seller.ozon.ru/v2/product/list",{filter:e,limit:a,offset:n},{headers:{"Client-Id":t.clientId,"Api-Key":t.apiKey,"Content-Type":"application/json"}});return{data:s.data,error:null}}catch(t){return{data:null,error:t.response?.data?.message||"Ошибка получения списка товаров"}}},getProductInfo=async(t,e)=>{try{let a=await r.Z.post("https://api-seller.ozon.ru/v2/product/info/list",{product_id:e},{headers:{"Client-Id":t.clientId,"Api-Key":t.apiKey,"Content-Type":"application/json"}});return{data:a.data,error:null}}catch(t){return{data:null,error:t.response?.data?.message||"Ошибка получения информации о товарах"}}},getProductStock=async(t,e)=>{try{let a=await r.Z.post("https://api-seller.ozon.ru/v3/product/info/stocks",{product_id:e},{headers:{"Client-Id":t.clientId,"Api-Key":t.apiKey,"Content-Type":"application/json"}});return{data:a.data,error:null}}catch(t){return{data:null,error:t.response?.data?.message||"Ошибка получения информации об остатках"}}},getProductPrices=async(t,e)=>{try{let a=await r.Z.post("https://api-seller.ozon.ru/v4/product/info/prices",{product_id:e},{headers:{"Client-Id":t.clientId,"Api-Key":t.apiKey,"Content-Type":"application/json"}});return{data:a.data,error:null}}catch(t){return{data:null,error:t.response?.data?.message||"Ошибка получения информации о ценах"}}},getCategories=async t=>{try{let e=await r.Z.post("https://api-seller.ozon.ru/v2/category/tree",{},{headers:{"Client-Id":t.clientId,"Api-Key":t.apiKey,"Content-Type":"application/json"}});return{data:e.data,error:null}}catch(t){return{data:null,error:t.response?.data?.message||"Ошибка получения категорий товаров"}}},checkAndDisableCampaignsIfBudgetExceeded=async(t,e,a,r=!0)=>{try{let n=new Date().toISOString().split("T")[0],{data:s,error:i}=await getPerformanceStatistics(e,n,n);if(i)throw Error(i);let d=0,o={};s&&s.rows&&s.rows.forEach(t=>{let e=t.dimensions.find(t=>"CAMPAIGN_ID"===t.id)?.value,a=t.dimensions.find(t=>"CAMPAIGN_NAME"===t.id)?.value,r=t.metrics.find(t=>"SPENDING"===t.id)?.value||0;e&&(o[e]={id:e,name:a,spent:parseFloat(r)},d+=parseFloat(r))});let l=d>=a;if(l&&r){let{data:e,error:r}=await getCampaignsList(t);if(r)throw Error(r);let n=e?.campaigns?.filter(t=>"active"===t.state)||[];if(n.length>0){let e=n.map(t=>({campaignId:t.id,status:"paused"})),{data:r,error:s}=await updateCampaignsStatuses(t,e);if(s)throw Error(s);return{data:{budgetExceeded:!0,totalSpent:d,dailyBudget:a,campaignsDisabled:r.success,campaignSpending:o},error:null}}}return{data:{budgetExceeded:l,totalSpent:d,dailyBudget:a,campaignsDisabled:0,campaignSpending:o},error:null}}catch(t){return{data:null,error:t.message||"Ошибка проверки и отключения кампаний"}}}},5413:(t,e,a)=>{a.d(e,{OQ:()=>n,m1:()=>getBudgetSettings,rO:()=>updateBudgetSettings});var r=a(2730);let n=(0,r.createClient)("https://llkacrchwiefgdgmuixl.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imxsa2FjcmNod2llZmdkZ211aXhsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc0NjYyNzQsImV4cCI6MjA2MzA0MjI3NH0.b9RLZFDfQH_svlQDF0V2g90P3vwPorlnwGZLl3S69-U"),getBudgetSettings=async t=>{let{data:e,error:a}=await n.from("budget_settings").select("*").eq("user_id",t).single();return a&&"PGRST116"!==a.code?{data:null,error:a}:{data:e||{user_id:t,daily_limit:0,notification_threshold:80,is_active:!0},error:null}},updateBudgetSettings=async(t,e)=>{let a={user_id:t,...e,updated_at:new Date().toISOString()},{data:r,error:s}=await n.from("budget_settings").upsert(a).select().single();return{data:r,error:s}}}};