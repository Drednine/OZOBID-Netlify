(()=>{var e={};e.id=571,e.ids=[571],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1630:e=>{"use strict";e.exports=require("http")},1645:e=>{"use strict";e.exports=require("net")},1820:e=>{"use strict";e.exports=require("os")},1997:e=>{"use strict";e.exports=require("punycode")},2412:e=>{"use strict";e.exports=require("assert")},2782:(e,t,r)=>{Promise.resolve().then(r.bind(r,8547))},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3873:e=>{"use strict";e.exports=require("path")},3997:e=>{"use strict";e.exports=require("tty")},4075:e=>{"use strict";e.exports=require("zlib")},4631:e=>{"use strict";e.exports=require("tls")},4735:e=>{"use strict";e.exports=require("events")},4853:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>l.a,__next_app__:()=>u,pages:()=>d,routeModule:()=>p,tree:()=>n});var s=r(5239),a=r(8088),i=r(8170),l=r.n(i),c=r(893),o={};for(let e in c)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>c[e]);r.d(t,o);let n={children:["",{children:["products",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,8547)),"F:\\00. Проекты веб дизайна и другое\\OZOBID\\OZOBID-Railway\\src\\app\\products\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,4431)),"F:\\00. Проекты веб дизайна и другое\\OZOBID\\OZOBID-Railway\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,7398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,9999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,5284,23)),"next/dist/client/components/unauthorized-error"]}]}.children,d=["F:\\00. Проекты веб дизайна и другое\\OZOBID\\OZOBID-Railway\\src\\app\\products\\page.tsx"],u={require:r,loadChunk:()=>Promise.resolve()},p=new s.AppPageRouteModule({definition:{kind:a.RouteKind.APP_PAGE,page:"/products/page",pathname:"/products",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:n}})},5511:e=>{"use strict";e.exports=require("crypto")},5591:e=>{"use strict";e.exports=require("https")},5830:(e,t,r)=>{Promise.resolve().then(r.bind(r,7237))},7237:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>o});var s=r(687),a=r(3210),i=r(3161),l=r(6391);let c=({userId:e,credentials:t})=>{let[r,c]=(0,a.useState)(!1),[o,n]=(0,a.useState)(""),[d,u]=(0,a.useState)("success"),[p,x]=(0,a.useState)([]),[h,m]=(0,a.useState)([]),[g,b]=(0,a.useState)([]),[f,y]=(0,a.useState)(""),[j,v]=(0,a.useState)(""),[w,N]=(0,a.useState)("all"),[_,k]=(0,a.useState)("name"),[S,q]=(0,a.useState)("asc"),[C,O]=(0,a.useState)(1),[E,I]=(0,a.useState)(1),[P,D]=(0,a.useState)(!1),[B,R]=(0,a.useState)(new Set),[Z,z]=(0,a.useState)(!1);(0,a.useEffect)(()=>{F(),M()},[e,t]),(0,a.useEffect)(()=>{A()},[p,f,j,w,_,S]);let F=async()=>{try{D(!0);let{data:e,error:r}=await (0,i.bW)(t);if(r)throw Error("Ошибка при загрузке категорий: "+r);e&&e.result&&b(e.result)}catch(e){n(e.message),u("error")}finally{D(!1)}},M=async()=>{try{c(!0),n("");let e={};f&&(e.category_id=parseInt(f)),j&&(e.search=j);let{data:r,error:s}=await (0,i.qr)(t,e,1e3,0);if(s)throw Error("Ошибка при загрузке списка товаров: "+s);if(!r||!r.result||!r.result.items){x([]),n("Товары не найдены"),u("warning");return}let a=r.result.items.map(e=>e.product_id);if(0===a.length){x([]),n("Товары не найдены"),u("warning");return}let{data:l,error:o}=await (0,i.oM)(t,a);if(o)throw Error("Ошибка при загрузке информации о товарах: "+o);let{data:d,error:p}=await (0,i.wx)(t,a);if(p)throw Error("Ошибка при загрузке информации об остатках: "+p);let{data:h,error:m}=await (0,i.kp)(t,a);if(m)throw Error("Ошибка при загрузке информации о ценах: "+m);let g=[];l&&l.result&&l.result.items&&l.result.items.forEach(e=>{let t=d?.result?.items?.find(t=>t.product_id===e.product_id),r=h?.result?.items?.find(t=>t.product_id===e.product_id);g.push({product_id:e.product_id,offer_id:e.offer_id||"",name:e.name||"Без названия",category:e.category||"Без категории",price:r?.price?.price||0,old_price:r?.price?.old_price,stock:t?.stocks?.reduce((e,t)=>e+t.present,0)||0,sku:e.sku||"",image_url:e.images?.[0]||"",status:e.status||"inactive"})}),x(g),0===g.length?(n("Товары не найдены"),u("warning")):(n(`Загружено ${g.length} товаров`),u("success"))}catch(e){n(e.message),u("error")}finally{c(!1)}},A=()=>{let e=[...p];if(f&&(e=e.filter(e=>e.category.toLowerCase().includes(f.toLowerCase()))),j){let t=j.toLowerCase();e=e.filter(e=>e.name.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)||e.offer_id.toLowerCase().includes(t))}"in-stock"===w?e=e.filter(e=>e.stock>0):"out-of-stock"===w&&(e=e.filter(e=>0===e.stock)),e.sort((e,t)=>"name"===_?"asc"===S?e.name.localeCompare(t.name):t.name.localeCompare(e.name):"price"===_?"asc"===S?e.price-t.price:t.price-e.price:"stock"===_?"asc"===S?e.stock-t.stock:t.stock-e.stock:0),m(e),I(Math.ceil(e.length/20)),O(1)},L=()=>{let e=(C-1)*20;return h.slice(e,e+20)},U=e=>{let t=new Set(B);t.has(e)?t.delete(e):t.add(e),R(t)},$=async()=>{if(0===B.size){n("Не выбрано ни одного товара"),u("warning");return}try{c(!0);let t=p.filter(e=>B.has(e.product_id)),{error:r}=await l.ND.from("exported_products").upsert(t.map(t=>({user_id:e,product_id:t.product_id,offer_id:t.offer_id,name:t.name,category:t.category,price:t.price,old_price:t.old_price||null,stock:t.stock,sku:t.sku,image_url:t.image_url||null,status:t.status,exported_at:new Date().toISOString()})));if(r)throw Error("Ошибка при сохранении товаров: "+r.message);n(`Успешно сохранено ${B.size} товаров`),u("success")}catch(e){n(e.message),u("error")}finally{c(!1)}},G=e=>new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB",minimumFractionDigits:2}).format(e);return(0,s.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"Выгрузка товаров"}),o&&(0,s.jsx)("div",{className:`p-4 mb-4 rounded ${"error"===d?"bg-red-100 text-red-700":"warning"===d?"bg-yellow-100 text-yellow-700":"bg-green-100 text-green-700"}`,children:o}),(0,s.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md mb-6",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Фильтры и поиск"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-gray-700 mb-2",children:"Категория"}),(0,s.jsxs)("select",{className:"w-full px-3 py-2 border rounded-md",value:f,onChange:e=>y(e.target.value),children:[(0,s.jsx)("option",{value:"",children:"Все категории"}),g.map(e=>(0,s.jsx)("option",{value:e.category_id,children:e.title},e.category_id))]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-gray-700 mb-2",children:"Поиск по названию/SKU"}),(0,s.jsx)("input",{type:"text",className:"w-full px-3 py-2 border rounded-md",placeholder:"Введите название или SKU",value:j,onChange:e=>v(e.target.value)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-gray-700 mb-2",children:"Наличие"}),(0,s.jsxs)("select",{className:"w-full px-3 py-2 border rounded-md",value:w,onChange:e=>N(e.target.value),children:[(0,s.jsx)("option",{value:"all",children:"Все товары"}),(0,s.jsx)("option",{value:"in-stock",children:"В наличии"}),(0,s.jsx)("option",{value:"out-of-stock",children:"Нет в наличии"})]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-gray-700 mb-2",children:"Сортировка"}),(0,s.jsxs)("select",{className:"w-full px-3 py-2 border rounded-md",value:_,onChange:e=>k(e.target.value),children:[(0,s.jsx)("option",{value:"name",children:"По названию"}),(0,s.jsx)("option",{value:"price",children:"По цене"}),(0,s.jsx)("option",{value:"stock",children:"По остатку"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-gray-700 mb-2",children:"Порядок"}),(0,s.jsxs)("select",{className:"w-full px-3 py-2 border rounded-md",value:S,onChange:e=>q(e.target.value),children:[(0,s.jsx)("option",{value:"asc",children:"По возрастанию"}),(0,s.jsx)("option",{value:"desc",children:"По убыванию"})]})]})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("button",{onClick:M,className:"bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded",disabled:r,children:r?"Загрузка...":"Обновить товары"}),(0,s.jsx)("button",{onClick:$,className:"bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded",disabled:r||0===B.size,children:r?"Сохранение...":`Сохранить выбранные (${B.size})`})]})]}),(0,s.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold",children:"Список товаров"}),(0,s.jsxs)("div",{className:"text-gray-600",children:["Всего: ",h.length," товаров"]})]}),h.length>0?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"min-w-full bg-white",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"bg-gray-100",children:[(0,s.jsx)("th",{className:"py-2 px-3 text-left",children:(0,s.jsx)("input",{type:"checkbox",checked:Z,onChange:()=>{let e=!Z;z(e);let t=new Set(B),r=L();e?r.forEach(e=>{t.add(e.product_id)}):r.forEach(e=>{t.delete(e.product_id)}),R(t)}})}),(0,s.jsx)("th",{className:"py-2 px-3 text-left",children:"Фото"}),(0,s.jsx)("th",{className:"py-2 px-3 text-left",children:"Название"}),(0,s.jsx)("th",{className:"py-2 px-3 text-left",children:"SKU"}),(0,s.jsx)("th",{className:"py-2 px-3 text-left",children:"Категория"}),(0,s.jsx)("th",{className:"py-2 px-3 text-right",children:"Цена"}),(0,s.jsx)("th",{className:"py-2 px-3 text-right",children:"Остаток"}),(0,s.jsx)("th",{className:"py-2 px-3 text-center",children:"Статус"})]})}),(0,s.jsx)("tbody",{children:L().map(e=>(0,s.jsxs)("tr",{className:"border-b hover:bg-gray-50",children:[(0,s.jsx)("td",{className:"py-2 px-3",children:(0,s.jsx)("input",{type:"checkbox",checked:B.has(e.product_id),onChange:()=>U(e.product_id)})}),(0,s.jsx)("td",{className:"py-2 px-3",children:e.image_url?(0,s.jsx)("img",{src:e.image_url,alt:e.name,className:"w-12 h-12 object-contain"}):(0,s.jsx)("div",{className:"w-12 h-12 bg-gray-200 flex items-center justify-center",children:(0,s.jsx)("span",{className:"text-gray-400 text-xs",children:"Нет фото"})})}),(0,s.jsx)("td",{className:"py-2 px-3",children:e.name}),(0,s.jsx)("td",{className:"py-2 px-3",children:e.sku}),(0,s.jsx)("td",{className:"py-2 px-3",children:e.category}),(0,s.jsxs)("td",{className:"py-2 px-3 text-right",children:[G(e.price),e.old_price&&(0,s.jsx)("div",{className:"text-gray-400 line-through text-xs",children:G(e.old_price)})]}),(0,s.jsx)("td",{className:"py-2 px-3 text-right",children:(0,s.jsx)("span",{className:e.stock>0?"text-green-600":"text-red-600",children:e.stock})}),(0,s.jsx)("td",{className:"py-2 px-3 text-center",children:(0,s.jsx)("span",{className:`px-2 py-1 rounded text-xs ${"active"===e.status?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:"active"===e.status?"Активен":"Неактивен"})})]},e.product_id))})]})}),E>1&&(0,s.jsx)("div",{className:"flex justify-center mt-6",children:(0,s.jsxs)("nav",{className:"flex items-center",children:[(0,s.jsx)("button",{onClick:()=>O(e=>Math.max(e-1,1)),disabled:1===C,className:"px-3 py-1 rounded-l border bg-white disabled:opacity-50",children:"\xab"}),Array.from({length:E},(e,t)=>t+1).map(e=>(0,s.jsx)("button",{onClick:()=>O(e),className:`px-3 py-1 border-t border-b ${C===e?"bg-blue-500 text-white":"bg-white"}`,children:e},e)),(0,s.jsx)("button",{onClick:()=>O(e=>Math.min(e+1,E)),disabled:C===E,className:"px-3 py-1 rounded-r border bg-white disabled:opacity-50",children:"\xbb"})]})})]}):(0,s.jsx)("div",{className:"text-center py-8 text-gray-500",children:r?(0,s.jsx)("div",{className:"flex justify-center items-center",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):"Нет товаров для отображения"})]})]})},o=()=>{let[e,t]=(0,a.useState)(null),[r,i]=(0,a.useState)(null),[o,n]=(0,a.useState)(!0),[d,u]=(0,a.useState)(null);return((0,a.useEffect)(()=>{(async()=>{try{n(!0);let{data:{user:e},error:r}=await l.ND.auth.getUser();if(r)throw Error("Ошибка авторизации: "+r.message);if(!e)throw Error("Необходимо авторизоваться");t(e.id);let{data:s,error:a}=await l.ND.from("ozon_credentials").select("*").eq("user_id",e.id).eq("is_active",!0).single();if(a&&"PGRST116"!==a.code)throw Error("Ошибка при получении учетных данных: "+a.message);if(!s)throw Error("Необходимо добавить учетные данные OZON");i({clientId:s.client_id,apiKey:s.api_key})}catch(e){u(e.message)}finally{n(!1)}})()},[]),o)?(0,s.jsx)("div",{className:"flex justify-center items-center min-h-screen",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):d?(0,s.jsxs)("div",{className:"max-w-md mx-auto mt-10 p-6 bg-white rounded-lg shadow-md",children:[(0,s.jsx)("div",{className:"text-red-500 mb-4",children:d}),(0,s.jsx)("button",{onClick:()=>window.location.href="/",className:"bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded",children:"Вернуться на главную"})]}):(0,s.jsx)("div",{className:"container mx-auto px-4 py-8",children:e&&r&&(0,s.jsx)(c,{userId:e,credentials:r})})}},7910:e=>{"use strict";e.exports=require("stream")},8354:e=>{"use strict";e.exports=require("util")},8547:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});let s=(0,r(2907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"F:\\\\00. Проекты веб дизайна и другое\\\\OZOBID\\\\OZOBID-Railway\\\\src\\\\app\\\\products\\\\page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"F:\\00. Проекты веб дизайна и другое\\OZOBID\\OZOBID-Railway\\src\\app\\products\\page.tsx","default")},9021:e=>{"use strict";e.exports=require("fs")},9121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},9428:e=>{"use strict";e.exports=require("buffer")},9551:e=>{"use strict";e.exports=require("url")}};var t=require("../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[825,414,497],()=>r(4853));module.exports=s})();